<style>
  .bold_label {font-weight:bold !important; }
  #mobile_push_notification_new input[type="text"], input[type="email"], input[type="url"], input[type="password"], input[type="file"], select, textarea {margin:0 5px;width:90% !important;font-weight:normal;}
  #mobile_push_notification_new .create-ex{margin-left:0 !important}
  #mobile_push_notification_new label{width:99% !important}
  .app-preview {
    display: inline-block;
    width: 70.45%;
    border: 1px solid #CCC;
    vertical-align: top;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    margin-top: 2%;
  }
  #preview{width:99%;height:900px}
  #mobile_push_notification_new .preview_link{float:left;width:auto;margin-right:40px;font-weight:bold;font-size:14px;}
  #mobile_push_notification_new h5 {margin-left:10px}
  .bg {
    background-image: url(http://beta.socialappshq.com:8087/images/socialapps/mobile_panel.png);
    width: 30%;
    height: 575px;
    background-repeat: no-repeat;
    float: left;
    margin-left: 3%;
    margin-top: 6%;
  }
  a:hover {background:#3f6eba;color:white;text-decoration:none;}
</style>
<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
<h1 style="width:100% !important; text-align:left">Setup <%=@mobile_campaign.title%></h1>
<div style="border-bottom:1px solid #ccc; width:98%; margin-top:-1%;"></div>
<div class="create-campaign-left" style="width:28% !important;border-radius: 5px;border: 1px solid #808080;overflow: hidden; padding-bottom:2.5% ;margin-top: 25px; min-height:683px">
  <form action="#" method="post" id="mobile_push_notification_new">
    <input id="campaign_id" name="campaign[id]" type="hidden" value="<%=params[:id]%>">
    <ul>
      <li>
        <div class="tools" onclick="custom_accordion('tab_cont','share','cus_users' ,'gen');">
          <span class="col-circle">1</span>
          <span class="tools_tab_name">Push Notification Settings</span>
          <span style="float:right" class="arr_up" id="gen">&#8594;</span>
        </div>
        <div class="toggleq" style="display:none">
          <div class="row" id="tab_cont">
            <div class="create-campaign-left-row ">
              <label class="bold_label">Push Notification Title</label>
              <input id="campaign_header_message" name="campaign[header_message]" type="text" placeholder="Header Message" value="<%=@campaign.header_message%>"/>
              <small class="create-ex create_campaign_note">e.g. Title</small>
            </div>

            <div class="create-campaign-left-row">
              <label class="bold_label">Push Notification Message</label>
              <input id="campaign_main_message" name="campaign[main_message]" type="text" placeholder="Main Message" value="<%=@campaign.main_message%>"/>
              <small class="create-ex create_campaign_note">e.g. Push Notification Message to display.</small>
            </div>

            <div class="create-campaign-left-row">
              <label class="bold_label">Name of App Activity</label>
              <input id="campaign_activity" name="campaign[activity]" type="text" placeholder="MainActivity" value="<%=@campaign.activity%>"/>
            </div>

            <div class="create-campaign-left-row">
              <label class="bold_label">Date</label>
              <input id="campaign_date" name="campaign[date]" type="text" placeholder="MainActivity" value="<%=@campaign.date%>"/>
            </div>

            <div class="create-campaign-left-row">
              <label class="bold_label">Time</label>
              <input id="campaign_time" name="campaign[time]" type="text" placeholder="MainActivity" value="<%=@campaign.time%>"/>
            </div>
          </div>
        </div>

        <div onclick="custom_accordion('share','tab_cont','cus_users','res');" class="tools" >
          <span class="col-circle">2</span>
          <span class="tools_tab_name">Audience Targeting </span>
          <span style="float:right" class="arr_up" id="res">&#8594;</span>
        </div>
        <div class="toggleq" style="display:none">
          <div class="row" id="share">
            <div class="create-campaign-left-row">
              <%= render :partial => 'member/setup/mobile/user_filter'%>
            </div>
          </div>
        </div>
      </li>
    </ul>

    <a href="#" class="campaign-configure-button"
       style="float:left;margin-left:1% !important; color: white !important; text-decoration: none !important;width:97% !important"
       onclick="configure_mobile_push_notification('preview'); return false;">Save Configuration</a>

    <div class="pro_box" style="display:none;border:none;width: 98%;margin: 10px 0 0 5px;float: left; color:green; margin-left:6%;"></div>
  </form>
</div>
<div class="app-preview">
  <h3 style="font-family: Arial;margin:5px;font-size:18px;color:#244386 !important;border-bottom: 1px solid #ccc;width: 98%;padding: 7px 2px !important;">Preview</h3>
  <div class="create-campaign-right" style="width:96% !important; margin: 1% 1% 1%">

    <div style="width:40%;height: 575px;float: left;margin-top: 6%;">
      <div class="coupon_popup" style="background: white;height: auto;clear: none;margin-top:-15%;float: left;">
        <img src="http://shqblogimages.s3.amazonaws.com/androidpush.png" style="max-height:350px">
      </div>
    </div>


    <div style="width:40%;height: 575px;float: left;">
      <div style="width:80%;background: white;border: 3px solid #555;height: 80px;clear: none;margin-top: 16%;margin-left: 4%;float: left;border-radius: 2px;">
        <div style="height: 98%;width: 31%;float:left">
          <img style="max-height:95%;max-width:95%;"src="/images/Logo128.png"></img>
        </div>
        <div style="height: 98%;width: 68%;float: right;">
          <p id="header_mssg" style="font-size: 18px; margin-left: -1px;margin-top: -2px;font-weight:bold;"><%=@campaign.header_message%></p>
          <p id="main_mssg" style="font-size: 12px; color:black; margin: -12px -1px;"><%=@campaign.main_message%></p><br/>
        </div>
      </div>

    </div>
    <div style="float:left; width:69%; margin-top: -27%;">
      <div style="float:left; width:33%; margin-left:19%;">In-app Notification</div>
      <div style="float: right">Isolate view of Notification</div>
    </div>
  </div>
</div>
<div style="clear:both; padding:10px;"></div>


<script>
  function custom_accordion(id_1, id_2, id_3,id_4){
    jQuery('.toggleq').css({'display':'block'});
    jQuery('#slash').html('&#8594;');
    jQuery('#res').html('&#8594;');
    jQuery('#gen').html('&#8594;');
    jQuery('#'+id_4).html('&#8595;');
    jQuery('#' + id_1).slideDown();
    jQuery('#' + id_2).slideUp();
    jQuery('#' + id_3).slideUp();
  }
  function show_row(div_id) {
    jQuery('#'+div_id).toggle();
  }

  //this function is used to get the value of all filters applicable and make it in array of arrays form(for saving purpose) ...
  function save_filters_data()
  {
    if ( $('.custom-filters li').length != 0 )
    {
      //Getting the last <li> element of ul
      var _last_li_id = $('.add-more').prev().attr('id');
      var _length_of_li_elements = _last_li_id.split("-")[2];
      var array_of_filters = new Array; //String which is to be save in db and contains list of all filters.
      for(var i=0;i<=_length_of_li_elements;i++)
      {
        if (($('#filter-row-'+i).is(':empty')) == false)
        {
          var array_of_values = new Array;
          array_of_values[0] = $('#select-filter-'+i).val();
          array_of_values[1] = $('#select-qual-'+i).children(":selected").val();

          if ($('#input_method_'+i).length > 0)
          {
            array_of_values[2] = $('#input_method_'+i).children(":selected").val();
          }
          else if ($('#inp_'+i).length > 0)
          {
            array_of_values[2] = $('#inp_'+i).val();
          }

          console.log("arr_of_values = "+array_of_values);
          if (array_of_values[0] != '' && array_of_values[1] != '' && array_of_values[2] != '')
          {
            array_of_filters.push(array_of_values);
          }
        }
      }
      console.log("array_of_filters  = " + array_of_filters);
      //Finally the data formed would be as :
      return array_of_filters;
      // [[filter_option_val,qual_option_val,input_val],[filter_option_val,qual_option_val,input_val],...]
    }
  };


  function configure_mobile_push_notification(mode)
  {
    if ((jQuery("#campaign_header_message").val( ) == "") || (jQuery("#campaign_main_message").val( ) == "") || (jQuery("#campaign_first_button_text").val( ) == ""))
    {
      alert ('Please specify all input fields');
      return ;
    }
    //    compute_ordering();

    dataString = jQuery('#mobile_push_notification_new').serialize();
    var _custom_filters = save_filters_data();
    dataString += "&filters="+JSON.stringify(_custom_filters);
    jQuery.ajax({
      url: "/member/setup/mobile/push/create_or_update",
      data: dataString,
      type: "POST",
      dataType: 'jsonp',
      cache: false,
      beforeSend: function(){
        jQuery('.pro_box').show();
        jQuery('.pro_box').html('<img src=\"/images/edelman/ajax-loader.gif\"/>');
      },
      success: function (response_data) {
        jQuery('.pro_box').hide();
        if (response_data.status == 'Error') {
          alert(response_data.message);
        } else {
          jQuery('.pro_box').html("Your configuration is successfully saved.");
          jQuery('#preview').attr("src", response_data.url);
        };
      },
      error: function(response_data) {
        jQuery('.pro_box').html(response_data.message);
      }
    });
  }

  jQuery("#campaign_header_message").keyup(function() { jQuery("#header_mssg").html(jQuery("#campaign_header_message").val());});
  jQuery("#campaign_main_message").keyup(function() { jQuery("#main_mssg").html(jQuery("#campaign_main_message").val());});
</script>
